# Inference/decoding configuration template for ESPnet3 ASR.
# Mirrors the training paths but keeps only inference-relevant knobs.

# Minimal runtime scaffold; fill in task in derived configs if needed.
num_device: 1
num_nodes: 1

# Path scaffold relative to the recipe root.
recipe_dir: .
data_dir: ${recipe_dir}/data
exp_tag: asr_template_eval
exp_dir: ${recipe_dir}/exp/${exp_tag}
stats_dir: ${recipe_dir}/exp/stats
decode_dir: ${exp_dir}/decode

# Dataset definition for test splits only.
dataset:
  dataset_module: src/dataset.py
  test:
    - name: test-clean
      dataset:
        split: test-clean

# Parallel execution used during data loading / scoring (defaults to local).
parallel:
  env: local
  n_workers: 1

# DataLoader defaults; keep small batch settings for lightweight decoding.
dataloader:
  collate_fn:
    _target_: espnet2.train.collate_fn.CommonCollateFn
    int_pad_value: -1
  train:
    multiple_iterator: false
    num_shards: 1
    iter_factory:
      _target_: espnet2.iterators.sequence_iter_factory.SequenceIterFactory
      shuffle: true
      collate_fn: ${dataloader.collate_fn}
      batches:
        type: numel
        shape_files:
          - ${stats_dir}/train/feats_shape
        batch_size: 4
        batch_bins: 4000000
  valid:
    multiple_iterator: false
    num_shards: 1
    iter_factory:
      _target_: espnet2.iterators.sequence_iter_factory.SequenceIterFactory
      shuffle: false
      collate_fn: ${dataloader.collate_fn}
      batches:
        type: ${dataloader.train.iter_factory.batches.type}
        shape_files:
          - ${stats_dir}/valid/feats_shape
        batch_size: ${dataloader.train.iter_factory.batches.batch_size}
        batch_bins: ${dataloader.train.iter_factory.batches.batch_bins}
