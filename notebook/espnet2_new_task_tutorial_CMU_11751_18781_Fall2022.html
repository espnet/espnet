<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>CMU 11751/18781 Fall 2022: ESPnet Tutorial2 (New task) &mdash; ESPnet 202211 documentation</title><link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../_static/jquery.js"></script>
        <script type="text/javascript" src="../_static/underscore.js"></script>
        <script type="text/javascript" src="../_static/doctools.js"></script>
        <script type="text/javascript" src="../_static/language_data.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
        <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
        <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true, "ignoreClass": "tex2jax_ignore|mathjax_ignore|document", "processClass": "tex2jax_process|mathjax_process|math|output_area"}})</script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="CMU 11751/18781 Fall 2022: ESPnet Tutorial" href="espnet2_recipe_tutorial_CMU_11751_18781_Fall2022.html" />
    <link rel="prev" title="Use transfer learning for ASR in ESPnet2" href="espnet2_asr_transfer_learning_demo.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../index.html" class="icon icon-home"> ESPnet
          </a>
              <div class="version">
                202211
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p><span class="caption-text">Tutorial:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorial.html">Usage</a></li>
<li class="toctree-l1"><a class="reference internal" href="../parallelization.html">Using Job scheduling system</a></li>
<li class="toctree-l1"><a class="reference internal" href="../faq.html">FAQ</a></li>
<li class="toctree-l1"><a class="reference internal" href="../docker.html">Docker</a></li>
</ul>
<p><span class="caption-text">ESPnet2:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../espnet2_tutorial.html">ESPnet2</a></li>
<li class="toctree-l1"><a class="reference internal" href="../espnet2_tutorial.html#instruction-for-run-sh">Instruction for run.sh</a></li>
<li class="toctree-l1"><a class="reference internal" href="../espnet2_training_option.html">Change the configuration for training</a></li>
<li class="toctree-l1"><a class="reference internal" href="../espnet2_task.html">Task class and data input system for training</a></li>
<li class="toctree-l1"><a class="reference internal" href="../espnet2_distributed.html">Distributed training</a></li>
</ul>
<p><span class="caption-text">Notebook:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="asr_cli.html">Speech Recognition (Recipe)</a></li>
<li class="toctree-l1"><a class="reference internal" href="asr_library.html">Speech Recognition (Library)</a></li>
<li class="toctree-l1"><a class="reference internal" href="espnet2_2pass_slu_demo.html">ESPNET 2 pass SLU Demonstration</a></li>
<li class="toctree-l1"><a class="reference internal" href="espnet2_asr_realtime_demo.html">ESPnet2-ASR realtime demonstration</a></li>
<li class="toctree-l1"><a class="reference internal" href="espnet2_asr_transfer_learning_demo.html"><strong>Use transfer learning for ASR in ESPnet2</strong></a></li>
<li class="toctree-l1"><a class="reference internal" href="espnet2_asr_transfer_learning_demo.html#Abstract">Abstract</a></li>
<li class="toctree-l1"><a class="reference internal" href="espnet2_asr_transfer_learning_demo.html#ESPnet-installation-(about-10-minutes-in-total)">ESPnet installation (about 10 minutes in total)</a></li>
<li class="toctree-l1"><a class="reference internal" href="espnet2_asr_transfer_learning_demo.html#mini_an4-recipe-as-a-transfer-learning-example">mini_an4 recipe as a transfer learning example</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">CMU 11751/18781 Fall 2022: ESPnet Tutorial2 (New task)</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#‚ùóImportant-Notes‚ùó">‚ùóImportant Notes‚ùó</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Useful-links">Useful links</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Objectives">Objectives</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Function-to-print-date-and-time">Function to print date and time</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="#Install-ESPnet-(Almost-same-procedure-as-your-first-tutorial)">Install ESPnet (Almost same procedure as your first tutorial)</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#Download-ESPnet">Download ESPnet</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Setup-Python-environment-based-on-anaconda-+-Install-ESPnet">Setup Python environment based on anaconda + Install ESPnet</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="#What-we-provide-you-and-what-you-need-to-proceed">What we provide you and what you need to proceed</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#ASVSpoof-data-preparation">ASVSpoof data preparation</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#Download-dataset">Download dataset</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Prepare-data-(Stage1-&amp;-Stage2)">Prepare data (Stage1 &amp; Stage2)</a></li>
<li class="toctree-l3"><a class="reference internal" href="#ASVSpoof-collect-stats-(‚úÖ-Checkpint-1-(1-point))">ASVSpoof collect stats (‚úÖ Checkpint 1 (1 point))</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#ASVSpoof-Model">ASVSpoof Model</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#Encoder-(‚úÖ-Checkpint-2-(1-point))">Encoder (‚úÖ Checkpint 2 (1 point))</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Decoder-(‚úÖ-Checkpint-3-(1-point))">Decoder (‚úÖ Checkpint 3 (1 point))</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#Model-Inference">Model Inference</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#(‚úÖ-Checkpint-4-(1-point))">(‚úÖ Checkpint 4 (1 point))</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#Scoring">Scoring</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#(‚úÖ-Checkpint-5-(1-point))">(‚úÖ Checkpint 5 (1 point))</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#üìó-Exercise-1-(1-point-bonus)">üìó Exercise 1 (1 point bonus)</a></li>
<li class="toctree-l2"><a class="reference internal" href="#üìó-Exercise-2-(1-point-bonus)">üìó Exercise 2 (1 point bonus)</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="espnet2_recipe_tutorial_CMU_11751_18781_Fall2022.html">CMU 11751/18781 Fall 2022: ESPnet Tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="espnet2_recipe_tutorial_CMU_11751_18781_Fall2022.html#Install-ESPnet">Install ESPnet</a></li>
<li class="toctree-l1"><a class="reference internal" href="espnet2_recipe_tutorial_CMU_11751_18781_Fall2022.html#Run-an-existing-recipe">Run an existing recipe</a></li>
<li class="toctree-l1"><a class="reference internal" href="espnet2_recipe_tutorial_CMU_11751_18781_Fall2022.html#Make-a-new-recipe">Make a new recipe</a></li>
<li class="toctree-l1"><a class="reference internal" href="espnet2_recipe_tutorial_CMU_11751_18781_Fall2022.html#Additional-resources">Additional resources</a></li>
<li class="toctree-l1"><a class="reference internal" href="espnet2_streaming_asr_demo.html">ESPnet2 real streaming Transformer demonstration</a></li>
<li class="toctree-l1"><a class="reference internal" href="espnet2_tts_realtime_demo.html">ESPnet2-TTS realtime demonstration</a></li>
<li class="toctree-l1"><a class="reference internal" href="espnet2_tutorial_2021_CMU_11751_18781.html">CMU 11751/18781 2021: ESPnet Tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="espnet2_tutorial_2021_CMU_11751_18781.html#Run-an-inference-example">Run an inference example</a></li>
<li class="toctree-l1"><a class="reference internal" href="espnet2_tutorial_2021_CMU_11751_18781.html#Full-installation">Full installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="espnet2_tutorial_2021_CMU_11751_18781.html#Run-a-recipe-example">Run a recipe example</a></li>
<li class="toctree-l1"><a class="reference internal" href="espnet_se_demonstration_for_waspaa_2021.html">ESPnet Speech Enhancement Demonstration</a></li>
<li class="toctree-l1"><a class="reference internal" href="espnet_se_demonstration_for_waspaa_2021.html#Contents">Contents</a></li>
<li class="toctree-l1"><a class="reference internal" href="espnet_se_demonstration_for_waspaa_2021.html#(1)-Tutorials-on-the-Basic-Usage">(1) Tutorials on the Basic Usage</a></li>
<li class="toctree-l1"><a class="reference internal" href="espnet_se_demonstration_for_waspaa_2021.html#(2)-Tutorials-on-Contributing-to-ESPNet-SE-Project">(2) Tutorials on Contributing to ESPNet-SE Project</a></li>
<li class="toctree-l1"><a class="reference internal" href="onnx_conversion_demo.html">espnet_onnx demonstration</a></li>
<li class="toctree-l1"><a class="reference internal" href="onnx_conversion_demo.html#Install-Dependency">Install Dependency</a></li>
<li class="toctree-l1"><a class="reference internal" href="onnx_conversion_demo.html#Export-your-model">Export your model</a></li>
<li class="toctree-l1"><a class="reference internal" href="onnx_conversion_demo.html#Inference-with-onnx">Inference with onnx</a></li>
<li class="toctree-l1"><a class="reference internal" href="onnx_conversion_demo.html#Using-streaming-model">Using streaming model</a></li>
<li class="toctree-l1"><a class="reference internal" href="pretrained.html">Pretrained Model</a></li>
<li class="toctree-l1"><a class="reference internal" href="se_demo.html">ESPnet Speech Enhancement Demonstration</a></li>
<li class="toctree-l1"><a class="reference internal" href="st_demo.html">ESPnet Speech Translation Demonstration</a></li>
<li class="toctree-l1"><a class="reference internal" href="tts_cli.html">Text-to-Speech (Recipe)</a></li>
<li class="toctree-l1"><a class="reference internal" href="tts_realtime_demo.html">ESPnet real time E2E-TTS demonstration</a></li>
</ul>
<p><span class="caption-text">Package Reference:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../_gen/espnet.asr.html">espnet.asr package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../_gen/espnet.scheduler.html">espnet.scheduler package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../_gen/espnet.optimizer.html">espnet.optimizer package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../_gen/espnet.transform.html">espnet.transform package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../_gen/espnet.tts.html">espnet.tts package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../_gen/espnet.utils.html">espnet.utils package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../_gen/espnet.lm.html">espnet.lm package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../_gen/espnet.vc.html">espnet.vc package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../_gen/espnet.bin.html">espnet.bin package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../_gen/espnet.st.html">espnet.st package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../_gen/espnet.mt.html">espnet.mt package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../_gen/espnet.distributed.html">espnet.distributed package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../_gen/espnet.nets.html">espnet.nets package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../_gen/espnet2.asr.html">espnet2.asr package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../_gen/espnet2.torch_utils.html">espnet2.torch_utils package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../_gen/espnet2.main_funcs.html">espnet2.main_funcs package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../_gen/espnet2.diar.html">espnet2.diar package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../_gen/espnet2.tts.html">espnet2.tts package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../_gen/espnet2.fileio.html">espnet2.fileio package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../_gen/espnet2.hubert.html">espnet2.hubert package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../_gen/espnet2.train.html">espnet2.train package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../_gen/espnet2.text.html">espnet2.text package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../_gen/espnet2.fst.html">espnet2.fst package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../_gen/espnet2.optimizers.html">espnet2.optimizers package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../_gen/espnet2.tasks.html">espnet2.tasks package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../_gen/espnet2.iterators.html">espnet2.iterators package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../_gen/espnet2.slu.html">espnet2.slu package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../_gen/espnet2.schedulers.html">espnet2.schedulers package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../_gen/espnet2.utils.html">espnet2.utils package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../_gen/espnet2.uasr.html">espnet2.uasr package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../_gen/espnet2.lm.html">espnet2.lm package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../_gen/espnet2.layers.html">espnet2.layers package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../_gen/espnet2.gan_svs.html">espnet2.gan_svs package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../_gen/espnet2.bin.html">espnet2.bin package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../_gen/espnet2.samplers.html">espnet2.samplers package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../_gen/espnet2.st.html">espnet2.st package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../_gen/espnet2.mt.html">espnet2.mt package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../_gen/espnet2.gan_tts.html">espnet2.gan_tts package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../_gen/espnet2.svs.html">espnet2.svs package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../_gen/espnet2.enh.html">espnet2.enh package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../_gen/espnet2.asr_transducer.html">espnet2.asr_transducer package</a></li>
</ul>
<p><span class="caption-text">Tool Reference:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../apis/espnet_bin.html">core tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../apis/espnet2_bin.html">core tools (espnet2)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../apis/utils_py.html">python utility tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../apis/utils_sh.html">bash utility tools</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">ESPnet</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home"></a></li>
      <li class="breadcrumb-item active">CMU 11751/18781 Fall 2022: ESPnet Tutorial2 (New task)</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/notebook/espnet2_new_task_tutorial_CMU_11751_18781_Fall2022.ipynb.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput.container div.prompt *,
div.nboutput.container div.prompt *,
div.nbinput.container div.input_area pre,
div.nboutput.container div.output_area pre,
div.nbinput.container div.input_area .highlight,
div.nboutput.container div.output_area .highlight {
    border: none;
    padding: 0;
    margin: 0;
    box-shadow: none;
}

div.nbinput.container > div[class*=highlight],
div.nboutput.container > div[class*=highlight] {
    margin: 0;
}

div.nbinput.container div.prompt *,
div.nboutput.container div.prompt * {
    background: none;
}

div.nboutput.container div.output_area .highlight,
div.nboutput.container div.output_area pre {
    background: unset;
}

div.nboutput.container div.output_area div.highlight {
    color: unset;  /* override Pygments text color */
}

/* avoid gaps between output lines */
div.nboutput.container div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput.container,
div.nboutput.container {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput.container,
    div.nboutput.container {
        flex-direction: column;
    }
}

/* input container */
div.nbinput.container {
    padding-top: 5px;
}

/* last container */
div.nblast.container {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput.container div.prompt pre {
    color: #307FC1;
}

/* output prompt */
div.nboutput.container div.prompt pre {
    color: #BF5B3D;
}

/* all prompts */
div.nbinput.container div.prompt,
div.nboutput.container div.prompt {
    width: 4.5ex;
    padding-top: 5px;
    position: relative;
    user-select: none;
}

div.nbinput.container div.prompt > div,
div.nboutput.container div.prompt > div {
    position: absolute;
    right: 0;
    margin-right: 0.3ex;
}

@media (max-width: 540px) {
    div.nbinput.container div.prompt,
    div.nboutput.container div.prompt {
        width: unset;
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput.container div.prompt.empty {
        padding: 0;
    }

    div.nbinput.container div.prompt > div,
    div.nboutput.container div.prompt > div {
        position: unset;
    }
}

/* disable scrollbars and line breaks on prompts */
div.nbinput.container div.prompt pre,
div.nboutput.container div.prompt pre {
    overflow: hidden;
    white-space: pre;
}

/* input/output area */
div.nbinput.container div.input_area,
div.nboutput.container div.output_area {
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput.container div.input_area,
    div.nboutput.container div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput.container div.input_area {
    border: 1px solid #e0e0e0;
    border-radius: 2px;
    /*background: #f5f5f5;*/
}

/* override MathJax center alignment in output cells */
div.nboutput.container div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.imgmath center alignment in output cells */
div.nboutput.container div.math p {
    text-align: left;
}

/* standard error */
div.nboutput.container div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-default-inverse-fg { color: #FFFFFF; }
.ansi-default-inverse-bg { background-color: #000000; }

.ansi-bold { font-weight: bold; }
.ansi-underline { text-decoration: underline; }


div.nbinput.container div.input_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight].math,
div.nboutput.container div.output_area.rendered_html,
div.nboutput.container div.output_area > div.output_javascript,
div.nboutput.container div.output_area:not(.rendered_html) > img{
    padding: 5px;
    margin: 0;
}

/* fix copybtn overflow problem in chromium (needed for 'sphinx_copybutton') */
div.nbinput.container div.input_area > div[class^='highlight'],
div.nboutput.container div.output_area > div[class^='highlight']{
    overflow-y: hidden;
}

/* hide copybtn icon on prompts (needed for 'sphinx_copybutton') */
.prompt .copybtn {
    display: none;
}

/* Some additional styling taken form the Jupyter notebook CSS */
.jp-RenderedHTMLCommon table,
div.rendered_html table {
  border: none;
  border-collapse: collapse;
  border-spacing: 0;
  color: black;
  font-size: 12px;
  table-layout: fixed;
}
.jp-RenderedHTMLCommon thead,
div.rendered_html thead {
  border-bottom: 1px solid black;
  vertical-align: bottom;
}
.jp-RenderedHTMLCommon tr,
.jp-RenderedHTMLCommon th,
.jp-RenderedHTMLCommon td,
div.rendered_html tr,
div.rendered_html th,
div.rendered_html td {
  text-align: right;
  vertical-align: middle;
  padding: 0.5em 0.5em;
  line-height: normal;
  white-space: normal;
  max-width: none;
  border: none;
}
.jp-RenderedHTMLCommon th,
div.rendered_html th {
  font-weight: bold;
}
.jp-RenderedHTMLCommon tbody tr:nth-child(odd),
div.rendered_html tbody tr:nth-child(odd) {
  background: #f5f5f5;
}
.jp-RenderedHTMLCommon tbody tr:hover,
div.rendered_html tbody tr:hover {
  background: rgba(66, 165, 245, 0.2);
}

/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast.container,
.nboutput.nblast.container {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast.container + .nbinput.container {
    margin-top: -19px;
}

.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}

/* Fix math alignment, see https://github.com/rtfd/sphinx_rtd_theme/pull/686 */
.math {
    text-align: unset;
}
</style>
<section id="CMU-11751/18781-Fall-2022:-ESPnet-Tutorial2-(New-task)">
<h1>CMU 11751/18781 Fall 2022: ESPnet Tutorial2 (New task)<a class="headerlink" href="#CMU-11751/18781-Fall-2022:-ESPnet-Tutorial2-(New-task)" title="Permalink to this headline">¬∂</a></h1>
<p><a class="reference external" href="https://github.com/espnet/espnet">ESPnet</a> is a widely-used end-to-end speech processing toolkit. It has supported various speech processing tasks. ESPnet uses PyTorch as a main deep learning engine, and also follows Kaldi style data processing, feature extraction/format, and recipes to provide a complete setup for speech recognition and other speech processing experiments.</p>
<p>Main references: - <a class="reference external" href="https://github.com/espnet/espnet">ESPnet repository</a> - <a class="reference external" href="https://espnet.github.io/espnet/">ESPnet documentation</a> - <a class="reference external" href="https://colab.research.google.com/github/espnet/notebook/blob/master/espnet2_tutorial_2021_CMU_11751_18781.ipynb">ESPnet tutorial in Speech Recognition and Understanding (Fall 2021)</a> - <a class="reference external" href="https://colab.research.google.com/drive/1tY6PxF_M5Nx5n488x0DrpujJOyqW-ATi?usp=sharing">Recitation in Multilingual NLP (Spring 2022)</a> - <a class="reference external" href="https://colab.research.google.com/drive/1d3yMY3xv_hpr2mznskZpF2Cj-bEooDv-?usp=sharing">ESPnet tutorial1 in Speech
Recognition and Understanding (Fall 2022)</a></p>
<p>Author: Jiatong Shi (<a class="reference external" href="mailto:jiatongs&#37;&#52;&#48;andrew&#46;cmu&#46;edu">jiatongs<span>&#64;</span>andrew<span>&#46;</span>cmu<span>&#46;</span>edu</a>)</p>
<p>We would like to thank You (Neil) Zhang for kindly helping the hands-on tutorial and sharing his knowledge on the task.</p>
<section id="‚ùóImportant-Notes‚ùó">
<h2>‚ùóImportant Notes‚ùó<a class="headerlink" href="#‚ùóImportant-Notes‚ùó" title="Permalink to this headline">¬∂</a></h2>
<ul class="simple">
<li><p>We are using Colab to show the demo. However, Colab has some constraints on the total GPU runtime. If you use too much GPU time, you may not be able to use GPU for some time.</p></li>
<li><p>There are multiple in-class checkpoints ‚úÖ throughout this tutorial. There will also be some after-class excersices üìó after the tutorial. <strong>Your participation points are based on these tasks.</strong> Please try your best to follow all the steps! If you encounter issues, please notify the TAs as soon as possible so that we can make an adjustment for you.</p></li>
<li><p>Please submit PDF files of your completed notebooks to Gradescope. You can print the notebook using <code class="docutils literal notranslate"><span class="pre">File</span> <span class="pre">-&gt;</span> <span class="pre">Print</span></code> in the menu bar.</p></li>
<li><p>This tutorial covers some advanced usage of ESPnet, which is the extension of the first tutorial.</p></li>
</ul>
</section>
<section id="Useful-links">
<h2>Useful links<a class="headerlink" href="#Useful-links" title="Permalink to this headline">¬∂</a></h2>
<ul class="simple">
<li><p>Installation <a class="reference external" href="https://espnet.github.io/espnet/installation.html">https://espnet.github.io/espnet/installation.html</a></p></li>
<li><p>Usage <a class="reference external" href="https://espnet.github.io/espnet/espnet2_tutorial.html">https://espnet.github.io/espnet/espnet2_tutorial.html</a></p></li>
<li><p>Reference of task class in ESPnet <a class="reference external" href="https://espnet.github.io/espnet/espnet2_task.html">https://espnet.github.io/espnet/espnet2_task.html</a></p></li>
</ul>
</section>
<section id="Objectives">
<h2>Objectives<a class="headerlink" href="#Objectives" title="Permalink to this headline">¬∂</a></h2>
<p>After this tutorial, you are expected to know: - How to add new task in ESPnet2 - How to add new models in ESPnet2 - How to create a new recipe (and template) of a new task from scratch</p>
</section>
<section id="Function-to-print-date-and-time">
<h2>Function to print date and time<a class="headerlink" href="#Function-to-print-date-and-time" title="Permalink to this headline">¬∂</a></h2>
<p>We first define a function to print the current date and time, which will be used in multiple places below.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">print_date_and_time</span><span class="p">():</span>
  <span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span>
  <span class="kn">import</span> <span class="nn">pytz</span>

  <span class="n">now</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(</span><span class="n">pytz</span><span class="o">.</span><span class="n">timezone</span><span class="p">(</span><span class="s2">&quot;America/New_York&quot;</span><span class="p">))</span>
  <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=&quot;</span> <span class="o">*</span> <span class="mi">60</span><span class="p">)</span>
  <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39; Current date and time: </span><span class="si">{</span><span class="n">now</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%m/</span><span class="si">%d</span><span class="s2">/%Y %H:%M:%S&quot;</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
  <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=&quot;</span> <span class="o">*</span> <span class="mi">60</span><span class="p">)</span>

<span class="c1"># example output</span>
<span class="n">print_date_and_time</span><span class="p">()</span>
</pre></div>
</div>
</div>
</section>
</section>
<section id="Install-ESPnet-(Almost-same-procedure-as-your-first-tutorial)">
<h1>Install ESPnet (Almost same procedure as your first tutorial)<a class="headerlink" href="#Install-ESPnet-(Almost-same-procedure-as-your-first-tutorial)" title="Permalink to this headline">¬∂</a></h1>
<section id="Download-ESPnet">
<h2>Download ESPnet<a class="headerlink" href="#Download-ESPnet" title="Permalink to this headline">¬∂</a></h2>
<p>We use <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">clone</span></code> to download the source code of ESPnet and then go to a specific commit.</p>
<p><strong>Important:</strong> In other versions of ESPnet, you may encounter errors related to imcompatible package versions (<code class="docutils literal notranslate"><span class="pre">numba</span></code>). Please use the same commit to avoid such issues.</p>
<p>Note that we are using another branch <code class="docutils literal notranslate"><span class="pre">espnet_tutorial_asvspoof</span></code> instead of ‚Äúmaster‚Äù. You can also use your own fork to proceed the following sections if you want to use Github to save your code.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre><span></span># It takes a few seconds
!git clone --depth 5 -b 2022fall_new_task_tutorial https://github.com/espnet/espnet

# We use a specific commit just for reproducibility.
%cd /content/espnet
!git checkout 9cff98a78ceaa4d85843be0a50b369ec826b27f6
</pre></div>
</div>
</div>
</section>
<section id="Setup-Python-environment-based-on-anaconda-+-Install-ESPnet">
<h2>Setup Python environment based on anaconda + Install ESPnet<a class="headerlink" href="#Setup-Python-environment-based-on-anaconda-+-Install-ESPnet" title="Permalink to this headline">¬∂</a></h2>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre><span></span># It takes 30 seconds
%cd /content/espnet/tools
!./setup_anaconda.sh anaconda espnet 3.9

# It may take 12 minutes
%cd /content/espnet/tools
!make TH_VERSION=1.12.1 CUDA_VERSION=11.6
</pre></div>
</div>
</div>
</section>
</section>
<section id="What-we-provide-you-and-what-you-need-to-proceed">
<h1>What we provide you and what you need to proceed<a class="headerlink" href="#What-we-provide-you-and-what-you-need-to-proceed" title="Permalink to this headline">¬∂</a></h1>
<p>We have provide you most of the files needed for ASVSpoof recipe. So you do not need to add any additional files. However, noted that some of the files are not complete and need your completion to proceed. For a quick overview of the whole layout of the new task, please refer to <a class="reference external" href="https://github.com/espnet/espnet/compare/master...2022fall_new_task_tutorial">https://github.com/espnet/espnet/compare/master‚Ä¶2022fall_new_task_tutorial</a></p>
<p>As elaborated in the warming-up, we have shown that there are two core components for a new task in ESPnet: a <strong>task library</strong> and correponding <strong>recipe setups</strong>. For the following of the section, we will briefly show the overall layout of adding the ASVSpoof task in ESPnet. The listed files are almost the minimum requirements to add a new task in ESPnet.</p>
<p><strong>Task library for ASVSpoof</strong></p>
<p>Followings are a list of files adding to ESPnet for ASVSpoof (files in ‚Äú‚Äù are ones that need modifications)</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>- espnet2
  - bin
    - asvspoof_train.py # Major entry point for asvspoof
    - &quot;asvspoof_inference.py&quot; (Checkpoint 4) # Inference scripts for asvspoof
  - asvspoof
    - decoder
      - __init__.py
      - abs_decoder.py # abstract class for decoder in ASVSpoof
      - &quot;linear_decoder.py&quot; (Checkpoint 3) # simple linear decoder for ASVSpoof
    - loss
      - __init__.py
      - abs_loss.py # abstract class for loss in ASVSpoof
      - binary_loss.py # naive binary class loss for ASVSpoof
      - am_softmax.py
      - &quot;oc_softmax.py&quot; (Bouns)
    - __init__.py
    - &quot;espnet_model.py&quot; (Bouns)
  - tasks
    - &quot;asvspoof.py&quot; (Checkpoint 2)
</pre></div>
</div>
<p>To help you understand more, we would recommend you to check the layout of other tasks (e.g., ASR, TTS, ST, etc.) to understand how the codebase is functioning.</p>
<p><strong>Recipe for ASVSpoof</strong></p>
<p>Followings are a list of files adding to ESPnet for ASVSpoof (files in boldface are ones that need modifications)</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>- egs2
  - TEMPLATE
    - asvspoof1
      - &quot;asvspoof.sh&quot; (Checkpoint 1)
      - others
  - espnet_tutorial
    - asvspoof11
      - conf
      - &quot;asvspoof.sh‚Äù (Checkpoint 1)
      - local
        - &quot;data_prep.py&quot; (Bouns)
        - &quot;data.sh&quot; (Bouns)
      - &quot;run.sh&quot; (Checkpoint 5)
      - scripts
      - pyscripts
      - utils
      - steps
      - path.sh
      - db.sh
      - cmd.sh
</pre></div>
</div>
<p>Noted that because of the <a class="reference external" href="https://www.freecodecamp.org/news/symlink-tutorial-in-linux-how-to-create-and-remove-a-symbolic-link/">symlink</a>, the <code class="docutils literal notranslate"><span class="pre">asvspoof.sh</span></code> is essentially the same for checkpoint 1.</p>
<section id="ASVSpoof-data-preparation">
<h2>ASVSpoof data preparation<a class="headerlink" href="#ASVSpoof-data-preparation" title="Permalink to this headline">¬∂</a></h2>
<p>As discussed in the warm-up session, ASVSpoof aims to conduct a binary classfication. As the task layout is a bit different from the ASR task we touched on the first tutorial, so we need to use a different format to formulate the data. For here, to keep the simplicity, we stil use the exact same file as the first tutorial:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>wav.scp text utt2spk spk2utt
</pre></div>
</div>
<p>But on the other hand, we change the format of text into</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>utt_id1 0
utt_id2 1
utt_id3 0
</pre></div>
</div>
<p>where 0 represents real speech and 1 stands for fake speech.</p>
<section id="Download-dataset">
<h3>Download dataset<a class="headerlink" href="#Download-dataset" title="Permalink to this headline">¬∂</a></h3>
<p>We first download the data from google drive. Noted that the data is a subset of the ASVSpoof2019 Challenge.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre><span></span># a few seconds
%cd /content/espnet/egs2/espnet_tutorial/asvspoof1/
!gdown 1HRdjjmGXBTXOqOq9iijuXPCA4y_46OzP
!unzip espnet_tutorial_asvspoof.zip
</pre></div>
</div>
</div>
</section>
<section id="Prepare-data-(Stage1-&amp;-Stage2)">
<h3>Prepare data (Stage1 &amp; Stage2)<a class="headerlink" href="#Prepare-data-(Stage1-&-Stage2)" title="Permalink to this headline">¬∂</a></h3>
<p>This time, we make the task template to be as simple as possible. The data preparation will be only two stages, including basic data preparation and wave format.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre><span></span># It may take around 6 minutes
!./asvspoof.sh --stage 1 --stop_stage 2 --train_set train --valid_set dev --test_sets &quot;eval&quot;
</pre></div>
</div>
</div>
</section>
<section id="ASVSpoof-collect-stats-(‚úÖ-Checkpint-1-(1-point))">
<h3>ASVSpoof collect stats (‚úÖ Checkpint 1 (1 point))<a class="headerlink" href="#ASVSpoof-collect-stats-(‚úÖ-Checkpint-1-(1-point))" title="Permalink to this headline">¬∂</a></h3>
<p>Similar to the previous tutorial, we collect the statisitcs for the data.</p>
<p>In the process, the data will be passed into a iterable loader. However, remember that the <code class="docutils literal notranslate"><span class="pre">text</span></code> file is no longer the format as the ASR recipe. Therefore, we will need to use another data loader to load the corresponding information.</p>
<p>Fortunately, we have a wide range of data loaders for choices, which is listing in <a class="reference external" href="https://github.com/espnet/espnet/blob/a7bd6522b32ec6472c13f6a2289dcdff4a846c12/espnet2/train/dataset.py#L130-L249">here</a>. Please choose the correct file format and replace the <code class="docutils literal notranslate"><span class="pre">[REPLACE_ME]</span></code> token in <code class="docutils literal notranslate"><span class="pre">asvspoof.sh</span></code></p>
<p>After the replacement, you should be able to run the following blocks</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre><span></span># It takes less than 2 minutes
!./asvspoof.sh --stage 3 --stop_stage 3 --train_set train --valid_set dev --test_sets &quot;dev eval&quot; --asvspoof_config conf/checkpoint1_dummy.yaml

# NOTE: Checkpoint 1
print_date_and_time()
</pre></div>
</div>
</div>
</section>
</section>
<section id="ASVSpoof-Model">
<h2>ASVSpoof Model<a class="headerlink" href="#ASVSpoof-Model" title="Permalink to this headline">¬∂</a></h2>
<p>In this section, we will define the ASVSpoof model and use the model to conduct the training of ASVSpoof task. For easier understanding, we first use an <code class="docutils literal notranslate"><span class="pre">encoder</span></code> to convert speech features into hidden representations and then use a <code class="docutils literal notranslate"><span class="pre">decoder</span></code> to conduct the classification.</p>
<section id="Encoder-(‚úÖ-Checkpint-2-(1-point))">
<h3>Encoder (‚úÖ Checkpint 2 (1 point))<a class="headerlink" href="#Encoder-(‚úÖ-Checkpint-2-(1-point))" title="Permalink to this headline">¬∂</a></h3>
<p>First, we are going to focus on the encoder part. There has been a long history over the discussion of the speech encoder in our community. Given the sequential perspective, people firstly investigated recurrent neural networks. More recently, we are focusing on <a class="reference external" href="https://arxiv.org/abs/2010.13956">conformer block</a>, which is an extension to the transformer block. In the previous settings, we used a transformer block to collect stats. However, we would want to switch to conformer.</p>
<p>Code-reusibility is one of the major benefits of using ESPnet as a toolkit for speech tasks. As ESPnet already support conformer block in ASR, it is easy to import into this new task.</p>
<p>In ESPnet, adding modules that we already have can be as simple as two-line codes. Please add lines into <code class="docutils literal notranslate"><span class="pre">/content/espnet/espnet2/tasks/asvspoof.py</span></code>. We have marked <code class="docutils literal notranslate"><span class="pre">TODO</span></code> in the scripts for your convenience.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre><span></span># It takes less than 2 minutes
!./asvspoof.sh --stage 3 --stop_stage 3 --train_set train --valid_set dev --test_sets &quot;dev eval&quot; --asvspoof_config conf/checkpoint2.yaml

# NOTE: Checkpoint 2
print_date_and_time()
</pre></div>
</div>
</div>
</section>
<section id="Decoder-(‚úÖ-Checkpint-3-(1-point))">
<h3>Decoder (‚úÖ Checkpint 3 (1 point))<a class="headerlink" href="#Decoder-(‚úÖ-Checkpint-3-(1-point))" title="Permalink to this headline">¬∂</a></h3>
<p>In this stage, we will finally start the training. As the previous tutorial, we can use the Tensorboard to monitor the process.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Load the TensorBoard notebook extension</span>
<span class="o">%</span><span class="n">reload_ext</span> <span class="n">tensorboard</span>

<span class="c1"># Launch tensorboard before training</span>
<span class="o">%</span><span class="n">tensorboard</span> <span class="o">--</span><span class="n">logdir</span> <span class="o">/</span><span class="n">content</span><span class="o">/</span><span class="n">espnet</span><span class="o">/</span><span class="n">egs2</span><span class="o">/</span><span class="n">espnet_tutorial</span><span class="o">/</span><span class="n">asvspoof1</span><span class="o">/</span><span class="n">exp</span>
</pre></div>
</div>
</div>
<p>After we finished the encoder, we also need to create a decoder to conduct the prediciton. As the encoder will generate hidden representations, we want to have a simple decoder to conduct mean-pooling to all the hidden representation at the time-axis. There should be another linear layer to conclude the models into binary classification. Please fill the missing part in <code class="docutils literal notranslate"><span class="pre">/conent/espnet/espnet2/asvspoof/decoder/linear_decoder.py</span></code> to finally start the training. For people who are not familiar
with Pytorch, please refer the related resources for details.</p>
<p>Related resources that could be helpful for this checkpoint: - <a class="reference external" href="https://pytorch.org/docs/stable/generated/torch.mean.html">https://pytorch.org/docs/stable/generated/torch.mean.html</a> - <a class="reference external" href="https://pytorch.org/docs/stable/generated/torch.nn.Linear.html">https://pytorch.org/docs/stable/generated/torch.nn.Linear.html</a> - <a class="reference external" href="https://pytorch.org/tutorials/beginner/basics/buildmodel_tutorial.html">https://pytorch.org/tutorials/beginner/basics/buildmodel_tutorial.html</a></p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre><span></span>!nvidia-smi

# Training takes around 2 minutes
!./asvspoof.sh --stage 4 --stop_stage 4 --train_set train --valid_set dev --test_sets &quot;dev eval&quot; --asvspoof_config conf/checkpoint2.yaml --inference_config conf/decode_asvspoof.yaml

# NOTE: Checkpoint 3
print_date_and_time()
</pre></div>
</div>
</div>
</section>
</section>
<section id="Model-Inference">
<h2>Model Inference<a class="headerlink" href="#Model-Inference" title="Permalink to this headline">¬∂</a></h2>
<section id="(‚úÖ-Checkpint-4-(1-point))">
<h3>(‚úÖ Checkpint 4 (1 point))<a class="headerlink" href="#(‚úÖ-Checkpint-4-(1-point))" title="Permalink to this headline">¬∂</a></h3>
<p>As the training is finished, we expect to conduct ASVSpoof on the test set. To approach that, we first have to finish the inference codebase. For our task specifically, we need the log-probability of the prediction to compute <a class="reference external" href="https://www.igi-global.com/dictionary/equal-error-rate-eer/35389">equal error rate (EER)</a>. Therefore the output should be a float number for each utterance.</p>
<p>Please fill the missing parts with <code class="docutils literal notranslate"><span class="pre">TODO</span></code>s in <code class="docutils literal notranslate"><span class="pre">/content/espnet/espnet2/bin/asvspoof_inference.py</span></code></p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre><span></span>!./asvspoof.sh --stage 5 --stop_stage 5 --train_set train --valid_set dev --test_sets &quot;eval&quot; --asvspoof_config conf/checkpoint2.yaml --inference_nj 1 --gpu_inference true

# NOTE: Checkpoint 4
print_date_and_time()
</pre></div>
</div>
</div>
</section>
</section>
<section id="Scoring">
<h2>Scoring<a class="headerlink" href="#Scoring" title="Permalink to this headline">¬∂</a></h2>
<section id="(‚úÖ-Checkpint-5-(1-point))">
<h3>(‚úÖ Checkpint 5 (1 point))<a class="headerlink" href="#(‚úÖ-Checkpint-5-(1-point))" title="Permalink to this headline">¬∂</a></h3>
<p>We have prepred the scoring script for you. We can get the EER by the following code-block</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre><span></span>!./asvspoof.sh --stage 6 --stop_stage 6 --train_set train --valid_set dev --test_sets &quot;eval&quot; --asvspoof_config conf/checkpoint2.yaml
!chmod +x scripts/utils/show_asvspoof_result.sh
# NOTE: Checkpoint 5
print_date_and_time()
</pre></div>
</div>
</div>
</section>
</section>
<section id="üìó-Exercise-1-(1-point-bonus)">
<h2>üìó Exercise 1 (1 point bonus)<a class="headerlink" href="#üìó-Exercise-1-(1-point-bonus)" title="Permalink to this headline">¬∂</a></h2>
<p>In the data you just downloaded, we have some extra data for training (<code class="docutils literal notranslate"><span class="pre">/content/espnet/egs2/espnet_tutorial/asvspoof1/espnet_asvspoof_tutorial/extend_train</span></code>). Please try to combine them with the training set and then conduct experiments the augmented set. You are also encouraged to change the model configuration. <strong>If you achieve a better equal error rate (EER) than the previous experiments, you can get a bonus point.</strong></p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># TODO</span>

<span class="c1"># NOTE: Exercise 1</span>
<span class="n">print_date_and_time</span><span class="p">()</span>
</pre></div>
</div>
</div>
</section>
<section id="üìó-Exercise-2-(1-point-bonus)">
<h2>üìó Exercise 2 (1 point bonus)<a class="headerlink" href="#üìó-Exercise-2-(1-point-bonus)" title="Permalink to this headline">¬∂</a></h2>
<p>One main issue of speech anti-spoofing research is the generalization to unseen attacks, i.e., synthesis methods not seen in training the anti-spoofing models. In fact, the test set in our scenario is exact in the same case. Recently, there is a <a class="reference external" href="https://arxiv.org/pdf/2010.13995.pdf">one-class learning method</a> that compacts the natural speech representations and separate them from the fake speech with a certain margin in the embedding space.</p>
<p>We have implemented the AM softmax method located in <code class="docutils literal notranslate"><span class="pre">/content/espnet/espnet2/asvspoof/loss/am_softmax_loss.py</span></code> and also prepared the template <code class="docutils literal notranslate"><span class="pre">/content/espnet/espnet2/asvspoof/loss/oc_softmax_loss.py</span></code> for your implementation. You can follow the TODOs to implement the methods (note that the inference/train_config should change accordingly).</p>
<p><strong>If you successfully implement the OC-softmax and get similar/better EER, you can get a bouns point</strong></p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># TODO</span>

<span class="c1"># NOTE: Exercise 2</span>
<span class="n">print_date_and_time</span><span class="p">()</span>
</pre></div>
</div>
</div>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="espnet2_asr_transfer_learning_demo.html" class="btn btn-neutral float-left" title="Use transfer learning for ASR in ESPnet2" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="espnet2_recipe_tutorial_CMU_11751_18781_Fall2022.html" class="btn btn-neutral float-right" title="CMU 11751/18781 Fall 2022: ESPnet Tutorial" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2017, Shinji Watanabe.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>