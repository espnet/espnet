<!-- Generated by scripts/utils/show_asr_result.sh -->
# ML_SUPERB data download
This can be referred to the ML-SUPERB [recipe](https://github.com/espnet/espnet/blob/master/egs2/ml_superb/asr1)

[Download link](https://drive.google.com/file/d/1QYjl-7vflle__3AfuosAC5VJGiBDvEqz/view?usp=drive_link)

After download the dataset, please set the `MLSUPERB` to the data directory. The preparation will be automatically done in scripts for each tasks.

# Bitrate calculation

We show how to calculate the bitrate in the baseline system (16.49). For each eval set, it follows three steps:
1. Convert the input text to index (`token_int.rm.wavlm_large_21_km2000`). This is because the baseline uses subword modeling (e.g BPE), and it is represented in CJK characters. **Note: as long as the input text is in index, this step can be skipped.**
   ```
   1272-135031-0014        784 0 1867 1102 866 2042 1209 184 187 1209 768 3 17 111 940 202 69 1518 217 337 1984 121 2383 916 276 2470 1287 217 833 508 690 161 211 161 211 206 174 30 96 3 729
   ```
2. `pyscripts/utils/convert_token2json.py` generates json file for `vocab`, `tokens`, `ref_len`.
3. `pyscripts/utils/calculate_bitrate.py` computes the bitrate

Finally, the overall bitrate is computed by aggregating the results of all eval sets.

```bash
$ token_suffix="wavlm_large_21_km2000"
$ bpe_folder="data/token_list/src_bpe_unigram3000_rm_wavlm_large_21_km2000"
$ bitrate_dir="./bitrate"
$ for dset in dev_clean dev_other test_clean test_other test_1h; do
$   paste \
$     <(<dump/raw/${dset}/text.rm.${token_suffix} cut -d" " -f1) \
$     <(<dump/raw/${dset}/text.rm.${token_suffix} spm_encode --model=${bpe_folder}/bpe.model --output_format=id) \
$     > dump/raw/${dset}/token_int.rm.${token_suffix}

$   python pyscripts/utils/convert_token2json.py \
$     --vocab data/token_list/src_bpe_unigram3000_rm_${token_suffix}/tokens.txt \
$     --token dump/raw/${dset}/token_int.rm.${token_suffix} \
$     --ref_scp data/${dset}/wav.scp \
$     --result_dir "${bitrate_dir}/${dset}"

$   python pyscripts/utils/calculate_bitrate.py \
$     --vocab "${bitrate_dir}/${dset}"/vocab.json \
$     --tokens "${bitrate_dir}/${dset}"/tokens.json \
$     --reference_len "${bitrate_dir}/${dset}"/ref_len.scp \
$     --bitrate_details "${bitrate_dir}/${dset}"/details.txt
$ done

$ python - <<EOF
import numpy as np
bitrates=[]
bitrate_dir="${bitrate_dir}"
for dset in ["dev_clean", "dev_other", "test_clean", "test_other", "test_1h"]:
    with open(f"{bitrate_dir}/{dset}/details.txt", "r") as f:
        for line in f.readlines():
            lst = line.strip().split()
            bitrates.append(float(lst[1]))
print(np.round(np.mean(bitrates), 2))

EOF

$ 16.49
```

# RESULTS
## Environments
- date: `Tue Oct 29 21:07:59 CDT 2024`
- python version: `3.8.18 | packaged by conda-forge | (default, Dec 23 2023, 17:21:28)  [GCC 12.3.0]`
- espnet version: `espnet 202402`
- pytorch version: `pytorch 2.4.0`
- Git hash: `440768294f1af7684e3753c6a4d384a5cd7ca21f`
  - Commit date: `Tue Oct 29 22:16:00 2024 -0400`

## exp/asr_train_discrete_asr_e_branchformer1_1gpu_lr5e-4_warmup30k_raw_wavlm_large_21_km2000_bpe_rm3000_bpe_ts6500
### WER

|dataset|Snt|Wrd|Corr|Sub|Del|Ins|Err|S.Err|
|---|---|---|---|---|---|---|---|---|
|decode_ctc0.3_asr_model_valid.acc.ave/dev_clean|2703|54402|95.4|4.3|0.3|0.4|4.9|51.5|
|decode_ctc0.3_asr_model_valid.acc.ave/dev_other|2864|50948|91.5|7.9|0.6|0.6|9.1|65.6|
|decode_ctc0.3_asr_model_valid.acc.ave/test_1h|24256|254316|42.1|48.1|9.8|4.8|62.7|94.8|
|decode_ctc0.3_asr_model_valid.acc.ave/test_clean|2620|52576|95.4|4.3|0.3|0.4|5.0|51.0|
|decode_ctc0.3_asr_model_valid.acc.ave/test_other|2939|52343|91.5|7.8|0.7|0.6|9.1|66.2|

### CER

|dataset|Snt|Wrd|Corr|Sub|Del|Ins|Err|S.Err|
|---|---|---|---|---|---|---|---|---|
|decode_ctc0.3_asr_model_valid.acc.ave/dev_clean|2703|288456|98.8|0.7|0.5|0.4|1.6|51.5|
|decode_ctc0.3_asr_model_valid.acc.ave/dev_other|2864|265951|97.3|1.5|1.1|0.7|3.4|65.6|
|decode_ctc0.3_asr_model_valid.acc.ave/test_1h|24256|1600215|81.0|11.2|7.7|3.9|22.9|94.8|
|decode_ctc0.3_asr_model_valid.acc.ave/test_clean|2620|281530|98.8|0.7|0.5|0.4|1.5|51.0|
|decode_ctc0.3_asr_model_valid.acc.ave/test_other|2939|272758|97.5|1.4|1.1|0.7|3.3|66.2|

### TER

|dataset|Snt|Wrd|Corr|Sub|Del|Ins|Err|S.Err|
|---|---|---|---|---|---|---|---|---|
|decode_ctc0.3_asr_model_valid.acc.ave/dev_clean|2703|137035|97.0|2.3|0.7|0.4|3.4|51.5|
|decode_ctc0.3_asr_model_valid.acc.ave/dev_other|2864|125959|94.0|4.5|1.5|0.9|6.9|65.6|
|decode_ctc0.3_asr_model_valid.acc.ave/test_1h|24256|1131804|72.6|19.0|8.4|4.5|32.0|94.8|
|decode_ctc0.3_asr_model_valid.acc.ave/test_clean|2620|133595|97.1|2.2|0.8|0.4|3.3|51.0|
|decode_ctc0.3_asr_model_valid.acc.ave/test_other|2939|129019|94.1|4.4|1.5|0.8|6.7|66.2|
