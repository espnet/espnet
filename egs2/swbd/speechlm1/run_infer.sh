# Stage 1: ASR decoding and post processing
./run.sh --stage 9 --stop_stage 9 --inference_model 20epoch.pth --test_sets eval2000_response
python pyscripts/text/remove_asr_hallucination.py exp/speechlm_codec_ssl_cot_full_utt2spk_librispeech_100_train_s2s_lr1e-5_fisher_complete/decode_asr_short2_20epoch/codec_ssl_cot_full_utt2spk_eval2000_response/src_text exp/speechlm_codec_ssl_cot_full_utt2spk_librispeech_100_train_s2s_lr1e-5_fisher_complete/decode_asr_short2_20epoch/codec_ssl_cot_full_utt2spk_eval2000_response/src_text_new
cp -r dump/raw_codec_ssl_cot_full_utt2spk_librispeech_100/eval2000_response dump/raw_codec_ssl_cot_full_utt2spk_librispeech_100/eval2000_response_combined_asr 
python local/get_text_dialogue.py exp/speechlm_codec_ssl_cot_full_utt2spk_librispeech_100_train_s2s_lr1e-5_fisher_complete/decode_asr_short2_20epoch/codec_ssl_cot_full_utt2spk_eval2000_response/src_text_new dump/raw_codec_ssl_cot_full_utt2spk_librispeech_100/eval2000_response_combined_asr/index_files/src_text
# Intermediate ASR results
mv exp/speechlm_codec_ssl_cot_full_utt2spk_librispeech_100_train_s2s_lr1e-5_fisher_complete/decode_asr_short2_20epoch/codec_ssl_cot_full_utt2spk_eval2000_response/src_text_new exp/speechlm_codec_ssl_cot_full_utt2spk_librispeech_100_train_s2s_lr1e-5_fisher_complete/decode_asr_short2_20epoch/codec_ssl_cot_full_utt2spk_eval2000_response/src_text
./run.sh --stage 10 --stop_stage 10 --inference_model 20epoch.pth --test_sets eval2000_response --scoring_args "--stop_stage 1"
# Stage 2: Text response generation
./run.sh --stage 9 --stop_stage 9 --inference_model 20epoch.pth --test_sets eval2000_response_combined_asr --inference_config conf/decode_asr_topk.yaml
python pyscripts/text/remove_hallucination.py exp/speechlm_codec_ssl_cot_full_utt2spk_librispeech_100_train_s2s_lr1e-5_fisher_complete/decode_asr_topk_20epoch/codec_ssl_cot_full_utt2spk_eval2000_response_combined_asr/text exp/speechlm_codec_ssl_cot_full_utt2spk_librispeech_100_train_s2s_lr1e-5_fisher_complete/decode_asr_topk_20epoch/codec_ssl_cot_full_utt2spk_eval2000_response_combined_asr/text_new
python pyscripts/text/get_shorter_response.py exp/speechlm_codec_ssl_cot_full_utt2spk_librispeech_100_train_s2s_lr1e-5_fisher_complete/decode_asr_topk_20epoch/codec_ssl_cot_full_utt2spk_eval2000_response_combined_asr/text_new dump/raw_codec_ssl_cot_full_utt2spk_librispeech_100/eval2000_response_combined_asr/index_files/src_text exp/speechlm_codec_ssl_cot_full_utt2spk_librispeech_100_train_s2s_lr1e-5_fisher_complete/decode_asr_topk_20epoch/codec_ssl_cot_full_utt2spk_eval2000_response_combined_asr/text_new2
cp -r dump/raw_codec_ssl_cot_full_utt2spk_librispeech_100/eval2000_response_combined_asr dump/raw_codec_ssl_cot_full_utt2spk_librispeech_100/eval2000_response_combined_asr_dialogue_debug 
python local/get_text_dialogue.py exp/speechlm_codec_ssl_cot_full_utt2spk_librispeech_100_train_s2s_lr1e-5_fisher_complete/decode_asr_topk_20epoch/codec_ssl_cot_full_utt2spk_eval2000_response_combined_asr/text_new2 dump/raw_codec_ssl_cot_full_utt2spk_librispeech_100/eval2000_response_combined_asr_dialogue_debug/index_files/text
# Stage 3: Final Speech Output generation
./run.sh --stage 9 --stop_stage 9 --inference_model 20epoch.pth --test_sets eval2000_response_combined_asr_dialogue --inference_config conf/decode_tts_espnet2_high_mos.yaml
# Results computation
./run.sh --stage 10 --stop_stage 10 --inference_model 20epoch.pth --test_sets eval2000_response_combined_asr_dialogue --scoring_args "--stage 2" --inference_config conf/decode_tts_espnet2_high_mos.yaml